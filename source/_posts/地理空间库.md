# GeoJson

> GeoJSON是一种用于编码各种地理数据结构的格式。

1. 结构

```json
{
  "type": "FeatureCollection",
  "features": [
        {
        "type":"Feature",
        "properties":{
            "name": "Dinagat Islands"
        },
        "geometry":{
            "type":"Point",
            "coordinates":[105.380859375,31.57853542647338]
            }
        }
    ]
}
```

`FeatureCollection`是根节点，所有地理要素放在features的列表里。

```json
{
  "type": "FeatureCollection",
  "features": []
}
```

2. 类型

`GeoJSON`支持以下几种类型：

- Point

    ```json
    {
        "type": "Feature",
        "properties": {},
        "geometry": {
            "type": "Point",
            "coordinates": [105.380859375, 31.57853542647338]
        }
    }
    ```

    点要素类型type对应`Point`，坐标是一维数组，里面有两个元素(如果是立体的坐标就是三维x,y,z)，分别为经度和纬度。`properties`里面可以封装各种属性。

- MultiPoint

    ```json
    {
        "type": "Feature",
        "properties": {},
        "geometry": {
            "type": "MultiPoint",
            "coordinates": 
            [
                [105.380859375, 31.57853542647338],
                [105.580859375, 31.52853542647338]
            ]
        }
    }
    ```

- LineString

    ```json
    {
        "type": "Feature",
        "properties": {},
        "geometry": {
            "type": "LineString",
            "coordinates": 
            [
                [105.6005859375, 30.65681556429287],
                [107.95166015624999, 31.98944183792288],
                [109.3798828125, 30.031055426540206],
                [107.7978515625, 29.935895213372444]
            ]
        }
    }
    ```

    线要素就是指线段，记录的是线的端点坐标，可视化时会按照记录顺序联结。

- MultiLineString

    ```json
    {
        "type": "Feature",
        "properties": {},
        "geometry": {
            "type": "MultiLineString",
            "coordinates": 
            [
                [
                    [105.6005859375, 30.65681556429287],
                    [107.95166015624999, 31.98944183792288],
                    [109.3798828125, 30.031055426540206],
                    [107.7978515625, 29.935895213372444]
                ],
                [
                    [109.3798828125, 30.031055426540206],
                    [107.1978515625, 31.235895213372444]
                ]
            ]
        }
    }
    ```

    三维数组，和多边形一样。

- Polygon

    ```json
    {
        "type": "Feature",
        "properties": {},
        "geometry": {
            "type": "Polygon",
            "coordinates": 
            [
                [
                    [106.10595703125, 33.33970700424026],
                    [106.32568359375, 32.41706632846282],
                    [108.03955078125, 32.2313896627376],
                    [108.25927734375, 33.15594830078649],
                    [106.10595703125, 33.33970700424026]
                ]
            ]
        }
    }
    ```

    单个多边形是一个三维数组，可以包含多个二维数组。

- MultiPolygon

    - 两个不相交的多边形

    ```json
    {
        "type": "Feature",
        "properties": {},
        "geometry": {
            "type": "MultiPolygon",
            "coordinates": 
            [
                [
                    [
                        [109.2041015625, 30.088107753367257],
                        [115.02685546875, 30.088107753367257],
                        [115.02685546875, 32.7872745269555],
                        [109.2041015625, 32.7872745269555],
                        [109.2041015625, 30.088107753367257]


                    ]
                ],
                [
                    [
                        [112.9833984375, 26.82407078047018],
                        [116.69677734375, 26.82407078047018],
                        [116.69677734375, 29.036960648558267],
                        [112.9833984375, 29.036960648558267],
                        [112.9833984375, 26.82407078047018]
                    ]
                ]
            ]
        }
    }
    ```

    - 两个嵌套的多边形

    小的在前面，范围大的在后面，用上4个中括号，但效果不是有洞的。

    ```json
    {
        "type": "Feature",
        "properties": {},
        "geometry": {
            "type": "MultiPolygon",
            "coordinates": 
            [
                [
                    [
                        [101.6455078125, 27.68352808378776],
                        [114.78515624999999, 27.68352808378776],
                        [114.78515624999999, 35.209721645221386],
                        [101.6455078125, 35.209721645221386],
                        [101.6455078125, 27.68352808378776]
                    ]
                ],
                [
                    [
                        [104.2822265625, 30.107117887092357],
                        [108.896484375, 30.107117887092357],
                        [108.896484375, 33.76088200086917],
                        [104.2822265625, 33.76088200086917],
                        [104.2822265625, 30.107117887092357]
                    ]
                ]
            ]
        }
    }
    ```

    - 有孔洞的多边形

    ```json
    {
        "type": "Feature",
        "properties": {},
        "geometry": {
            "type": "MultiPolygon",
            "coordinates": 
            [
                [
                    [
                        [101.6455078125, 27.68352808378776],
                        [114.78515624999999, 27.68352808378776],
                        [114.78515624999999, 35.209721645221386],
                        [101.6455078125, 35.209721645221386],
                        [101.6455078125, 27.68352808378776]


                    ],
                    [
                        [104.2822265625, 30.107117887092357],
                        [108.896484375, 30.107117887092357],
                        [108.896484375, 33.76088200086917],
                        [104.2822265625, 33.76088200086917],
                        [104.2822265625, 30.107117887092357]

                    ]
                ]
            ]
        }
    }
    ```

3. GeometryCollection

> GeometryCollection是多种基本地理要素的集合，里面可以包含点、线、面要素。

`GeometryCollection`不需要放在`FeatureCollection`里：

```json
{
	"type": "GeometryCollection",
	"geometries": [
        {
            "type": "Point",
            "coordinates": [108.62, 31.02819]
        }, 
        {
            "type": "LineString",
            "coordinates": [
                [108.896484375, 30.1071178870],
                [108.2184375, 30.91717870],
                [109.5184375, 31.2175780]
            ]
        }
    ]
}
```

4. 相关链接

- [geojson](http://geojson.io)

# JTS Topology Suite

> Java空间分析工具包。JTS是加拿大的Vivid Solutions公司做的一套开源的Java API。它提供了一套空间数据操作的核心算法。主要完成了java对几何对象、空间拓扑的核心操作算法。

![空间数据模型](https://raw.githubusercontent.com/zkRou/note/master/%E7%A9%BA%E9%97%B4%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B.png)

1. Geometry之间的关系，支持的空间操作包括：

| 函数名 | 功能 | 
| --- | --- |
| 相等(equals) | 几何形状拓扑上相等，是否有重叠 | 
| 分离/脱节(disjoint) | 几何形状没有共有的点 | 
| 相交(intersects) | 几何形状至少有一个共有点（区别于脱节） |
| 接触(touches) | 几何形状至少一个公共的边界点，但是没有内部点 | 
| 交叉(crosses) | 几何形状共享一些但不是所有的内部点 |
| 内含(within) | 几何形状A的线都在几何形状B内部 | 
| 包含(contains) | 几何形状B的线都在几何形状A内部（区别于内含）|
| 重叠(overlaps) | 几何形状共享一部分但不是所有的公共点，而且相交处有他们自己相同的区域 |

2. WKT(Well-known text)

> WKT是开放地理空间联盟OGC(Open GIS Consortium)制定的一种文本标记语言，用于表示矢量几何对象、空间参照系统及空间参照系统之间的转换。

| Type | WKT | 
| --- | --- | 
| Point | POINT(30 10) | 
| MultiPoint | MULTIPOINT ((10 40), (40 30), (20 20), (30 10)) |
| LineString | LINESTRING(30 10, 10 30, 40 40) |
| MultiLineString | MULTILINESTRING ((10 10, 20 20, 10 40),(40 40, 30 30, 40 20, 30 10)) |
| Polygon | POLYGON((30 10, 40 40, 20 40, 10 20, 30 10)) |
| MultiPolygon | MULTIPOLYGON (((30 20, 45 40, 10 40, 30 20)), ((15 5, 40 10, 10 20, 5 10, 15 5))) |
| Polygon | POLYGON ((35 10, 45 45, 15 40, 10 20, 35 10),(20 30, 35 35, 30 20, 20 30)) |
| MultiPolygon | MULTIPOLYGON (((40 40, 20 45, 45 30, 40 40)),((20 35, 10 30, 10 10, 30 5, 45 20, 20 35),(30 20, 20 15, 20 25, 30 20))) |


3. WKB(Well-known binary)

> WKB是WKT的二进制表示形式，解决了WKT表达方式冗余的问题，便于传输和在数据库中存储相同的信息。

4. Demo

```Java
package com.kris.pointinpolygondemo;

import com.vividsolutions.jts.geom.*;
import com.vividsolutions.jts.io.ParseException;
import com.vividsolutions.jts.io.WKTReader;

/**
 * @author ZENGKAIROU583
 */
public class GeometryRelated {

    public static void main(String[] args) throws ParseException {
        equalsGeo();
        disjointGeo();
        intersectsGeo();
        withinGeo(5d,5d,"POLYGON((0 0, 10 0, 10 10, 0 10,0 0))");
    }

    private static GeometryFactory geometryFactory = new GeometryFactory();

    /**
     * 两个几何对象是否有重叠
     */
    private static boolean equalsGeo() throws ParseException {
        WKTReader reader = new WKTReader(geometryFactory);
        LineString lineString1 = (LineString) reader.read("LINESTRING(0 0, 2 0, 5 0)");
        LineString lineString2 = (LineString) reader.read("LINESTRING(5 0, 0 0)");

        boolean isEquals = lineString1.equals(lineString2);
        System.out.println(isEquals);
        return isEquals;
    }

    /**
     * 几何对象没有交点(相邻)
     */
    private static boolean disjointGeo() throws ParseException {
        WKTReader reader = new WKTReader(geometryFactory);
        LineString lineString1 = (LineString) reader.read("LINESTRING(0 0, 2 0, 5 0)");
        LineString lineString2 = (LineString) reader.read("LINESTRING(0 1, 0 2)");

        boolean isDisjoint = lineString1.disjoint(lineString2);
        System.out.println(isDisjoint);
        return isDisjoint;
    }

    /**
     * 至少一个公共点(相交)
     */
    private static boolean intersectsGeo() throws ParseException {
        WKTReader reader = new WKTReader(geometryFactory);
        LineString lineString1 = (LineString) reader.read("LINESTRING(0 0, 2 0, 5 0)");
        LineString lineString2 = (LineString) reader.read("LINESTRING(0 0, 0 2)");

        Geometry geometry = lineString1.intersection(lineString2); //相交点
        System.out.println(geometry);

        boolean isIntersects = lineString1.intersects(lineString2);
        System.out.println(isIntersects);
        return isIntersects;
    }

    /**
     * 判断以x、y为坐标的点point(x,y)是否在polygon中
     */
    private static boolean withinGeo(double x, double y, String geometry) throws ParseException {
        Coordinate coordinate = new Coordinate(x, y);
        Point point = geometryFactory.createPoint(coordinate);

        WKTReader reader = new WKTReader(geometryFactory);
        Polygon polygon = (Polygon) reader.read(geometry);

        boolean isWithin = point.within(polygon);
        System.out.println(isWithin);
        return isWithin;
    }


}
```

5. 相关链接：

- [jts github](https://github.com/locationtech/jts)
- [JTS Topology Suite](https://locationtech.github.io/jts/)

# Java geotools

> geotools是一个GIS开源工具包。

1. GeoTools提供了一个[GeoJSON插件](https://docs.geotools.org/latest/userguide/unsupported/geojson.html)，可以将GeoJSON转换为GeoTools特性集合，这些集合的几何元素存储为一个JTS对象。

2. Demo

```Java
package com.kris.pointinpolygondemo;

import com.vividsolutions.jts.geom.*;
import com.vividsolutions.jts.io.ParseException;
import com.vividsolutions.jts.io.WKTReader;

/**
 * @author ZENGKAIROU583
 */
public class GeometryDemo {

    public static void main(String[] args) throws ParseException {
        System.out.println("=====POINT=====");
        createPoint();
        createPointByWKT();
        createMultiPointByWKT();
        System.out.println("=====LINE=====");
        createLine();
        createLineByWKT();
        createMultiLine();
        createMultiLineByWKT();
        System.out.println("=====POLYGON=====");
        createPolygonByWKT();
        createMultiPolygonByWKT();
        System.out.println("=====GeometryCollection=====");
        createGeometryCollection();
    }

    private static GeometryFactory geometryFactory = new GeometryFactory();

    /**
     * create a point
     */
    private static Point createPoint(){
        Coordinate coordinate = new Coordinate(109.01, 32.123);
        Point point = geometryFactory.createPoint(coordinate);
        System.out.println(point);

        return point;
    }

    /**
     * create a point by wkt
     */
    private static Point createPointByWKT() throws ParseException {
        WKTReader wktReader = new WKTReader(geometryFactory);
        Point point = (Point) wktReader.read("POINT (109.01 32.123)");
        System.out.println(point);
        return point;
    }

    /**
     * create MultiPoint by wkt
     */
    private static MultiPoint createMultiPointByWKT() throws ParseException {
        WKTReader wktReader = new WKTReader(geometryFactory);
        MultiPoint multiPoint = (MultiPoint) wktReader.read("MULTIPOINT(109.013388 32.715519,119.32488 31.435678)");
        System.out.println(multiPoint);
        return multiPoint;
    }

    /**
     * create a line
     */
    private static LineString createLine(){
        Coordinate[] coordinates = new Coordinate[]{
                new Coordinate(2,2),
                new Coordinate(2,2)
        };
        LineString line = geometryFactory.createLineString(coordinates);
        System.out.println(line);
        return line;
    }

    /**
     * create a line by WKT
     */
    private static LineString createLineByWKT() throws ParseException {
        WKTReader reader = new WKTReader(geometryFactory);
        LineString lineString = (LineString) reader.read("LINESTRING(0 0, 2 0)");
        System.out.println(lineString);
        return lineString;
    }

    /**
     * create multiLine
     */
    private static MultiLineString createMultiLine(){
        Coordinate[] coordinates1 = new Coordinate[]{
                new Coordinate(2,2),
                new Coordinate(2, 2)
        };
        LineString lineString1 = geometryFactory.createLineString(coordinates1);

        Coordinate[] coordinates2 = new Coordinate[]{
                new Coordinate(2,2),
                new Coordinate(2,2)
        };
        LineString lineString2 = geometryFactory.createLineString(coordinates2);

        LineString[] lineStrings = new LineString[2];
        lineStrings[0] = lineString1;
        lineStrings[1] = lineString2;
        MultiLineString multiLineString = geometryFactory.createMultiLineString(lineStrings);
        System.out.println(multiLineString);
        return  multiLineString;
    }

    /**
     * create multiLine by WKT
     */
    private static MultiLineString createMultiLineByWKT() throws ParseException {
        WKTReader wktReader = new WKTReader(geometryFactory);
        MultiLineString multiLineString = (MultiLineString) wktReader.read("MULTILINESTRING((0 0, 2 0),(1 1,2 2))");
        System.out.println(multiLineString);
        return multiLineString;
    }

    /**
     * create a polygon by WKT
     */
    private static Polygon createPolygonByWKT() throws ParseException {
        WKTReader wktReader = new WKTReader(geometryFactory);
        Polygon polygon = (Polygon) wktReader.read("POLYGON((20 10, 30 0, 40 10, 30 20, 20 10))");
        System.out.println(polygon);
        return polygon;
    }

    /**
     * create multi polygon by WKT
     */
    private static MultiPolygon createMultiPolygonByWKT() throws ParseException {
        WKTReader wktReader = new WKTReader(geometryFactory);
        MultiPolygon multiPolygon = (MultiPolygon) wktReader.read("MULTIPOLYGON(((40 10, 30 0, 40 10, 30 20, 40 10),(30 10, 30 0, 40 10, 30 20, 30 10)))");
        System.out.println(multiPolygon);
        return multiPolygon;
    }

    /**
     * create GeometryCollection contain point or multiPoint or line or multiLine or polygon or multiPolygon
     */
    private static GeometryCollection createGeometryCollection() throws ParseException {
        LineString lineString = createLine();
        Polygon polygon = createPolygonByWKT();

        Geometry geometry1 = geometryFactory.createGeometry(lineString);
        Geometry geometry2 = geometryFactory.createGeometry(polygon);

        Geometry[] geometries = new Geometry[]{geometry1, geometry2};
        GeometryCollection geometryCollection = geometryFactory.createGeometryCollection(geometries);
        System.out.println(geometryCollection);
        return geometryCollection;
    }

}
```

3. 相关链接：

- [geotools](https://www.geotools.org/)
- [geotools github](https://github.com/geotools/geotools)
- [geotools体系](https://blog.csdn.net/anglestar2012/article/details/42555819)